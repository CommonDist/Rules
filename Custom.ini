# ==============================================================
#
#   Mihomo é«˜çº§è®¢é˜…è½¬æ¢æ¨¡æ¿ (æœ€ç»ˆä¿®æ­£ç‰ˆ V2 - CommonDist ç²¾ç»†æ¨¡å¼)
#
#   è§„åˆ™æº: CommonDist/NewRules (å·²é‡‡ç”¨å­ç›®å½•ç²¾ç»†è§„åˆ™)
#   è¯´æ˜:
#     - æœ¬é…ç½®å·²å®Œå…¨æŒ‰ç…§ CommonDist/NewRules çš„é«˜çº§ç”¨æ³•æ„å»ºï¼Œ
#       é€šè¿‡å¼•ç”¨å­ç›®å½•ä¸‹çš„ç»†åˆ†è§„åˆ™ï¼Œå®ç°äº†å¯¹ä¸åŒåº”ç”¨ç±»å‹çš„ç²¾ç¡®åˆ†æµã€‚
#     - è¿™æ˜¯å®ç°å¤æ‚åˆ†æµç­–ç•¥çš„æœ€ç»ˆã€æœ€æ­£ç¡®ç‰ˆæœ¬ã€‚
#
# ==============================================================

# åŸºç¡€é…ç½®
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7895
ipv6: true

allow-lan: true
mode: rule
log-level: info

unified-delay: true
tcp-concurrent: true
external-controller: 0.0.0.0:9090
secret: ""
external-ui: "/usr/share/openclash/ui"
external-ui-name: metacubexd
keep-alive-interval: 15
keep-alive-idle: 600

geox-url:
  mmdb: https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/lite/Country.mmdb
  geoip: https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat
  geosite: https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat
  asn: https://testingcf.jsdelivr.net/gh/xishang0128/geoip@release/GeoLite2-ASN.mmdb
geo-auto-update: false # æ˜¯å¦è‡ªåŠ¨æ›´æ–° geodata
geo-update-interval: 24 # æ›´æ–°é—´éš”ï¼Œå•ä½ï¼šå°æ—¶

# ========================
# DNS è®¾ç½® (Fake-IP æ¨¡å¼)
# ========================

dns:
  enable: true
  listen: 0.0.0.0:7874 # ä¿æŒæ‚¨åŸæœ‰çš„ç›‘å¬ç«¯å£
  ipv6: false # é™¤éæ‚¨çš„ç½‘ç»œç¯å¢ƒå®Œç¾æ”¯æŒIPv6ï¼Œå¦åˆ™å»ºè®®å…³é—­ä»¥å¢åŠ ç¨³å®šæ€§
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16

  # é»˜è®¤/å›½å¤–åŸŸåè§£æ (ä½¿ç”¨æ— æ±¡æŸ“çš„ DoH/DoT åŠ å¯†DNS)
  nameserver:
    - https://dns.google/dns-query
    - https://1.1.1.1/dns-query
    - https://dns.alidns.com/dns-query # é˜¿é‡ŒDNSï¼Œå¢åŠ å¹¶å‘æŸ¥è¯¢çš„å¤šæ ·æ€§

  # åå¤‡DNS (å½“ä¸Šè¿°DNSè§£æå¤±è´¥æ—¶ä½¿ç”¨)
  fallback:
    - https://dns.alidns.com/dns-query # é˜¿é‡Œ DoH
    - https://dns.cloudflare.com/dns-query
    - https://dns.google/dns-query

  # DNS åˆ†æµç­–ç•¥ (æ ¸å¿ƒ)
  # ä¸ºç‰¹å®šåŸŸåæŒ‡å®šä¸“é—¨çš„ DNS æœåŠ¡å™¨
  nameserver-policy:
    # åŒ¹é…æ‰€æœ‰å›½å†…åŸŸåï¼Œå¼ºåˆ¶ä½¿ç”¨å›½å†…é«˜é€ŸDNSè¿›è¡Œè§£æ
    'geosite:cn':
      - 223.5.5.5
      - 119.29.29.29
      - 211.136.192.6 # ä¿ç•™ä¸€ä¸ªè¿è¥å•†DNSç”¨äºå›½å†…è§£æ

  # Fake-IP è¿‡æ»¤å™¨ (ç”¨äºç›´è¿æˆ–æœ‰å…¼å®¹æ€§é—®é¢˜çš„åŸŸå)
  fake-ip-filter:
    - '*.lan' # ä¿®æ­£å†™æ³•
    - '*.local' # ä¿®æ­£å†™æ³•
    - geosite:cn # æ¨èä¿ç•™ï¼Œè®©æ‰€æœ‰å›½å†…åŸŸåè·å–çœŸå®IPï¼Œå¢å¼ºç›´è¿å…¼å®¹æ€§

# ========================
# TUN æ¨¡å—
# ========================

tun:
  enable: true
  stack: gvisor
  device: utun
  dns-hijack:
  - 127ã€‚0ã€‚0ã€‚1:53
  endpoint-independent-nat: true
  auto-route: false
  auto-detect-interface: false
  auto-redirect: false
  strict-route: false

profile:
  store-selected: true
  store-fake-ip: true

# æ¨¡æ¿å ä½ç¬¦
proxy-providers:
  main-subscription:
    type: http
    url: "URL_PLACEHOLDER"
    interval: 86400 # 24å°æ—¶æ›´æ–°ä¸€æ¬¡
    path: ./proxies/main.yaml
    health-check:
      enable: true
      interval: 600 # 10åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
      url: https://www.gstatic.com/generate_204

# -------------------------------------------------------
# ç­–ç•¥ç»„å®šä¹‰ (æ ¸å¿ƒåŠ¨æ€åˆ†ç»„é€»è¾‘ï¼Œéå¸¸å¼ºå¤§)
# -------------------------------------------------------

proxy-groups:
  - name: "ğŸš€ PROXY"
    type: select
    proxies: ["â™»ï¸ è‡ªåŠ¨é€‰æ‹©", "â›‘ï¸ æ•…éšœè½¬ç§»", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹", "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "ğŸŒ å…¶ä»–åœ°åŒº", DIRECT]
  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    url: https://www.gstatic.com/generate_204
    interval: 300
    use: [main-subscription]
  - name: "â›‘ï¸ æ•…éšœè½¬ç§»"
    type: fallback
    url: https://www.gstatic.com/generate_204
    interval: 300
    use: [main-subscription]
  - name: "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
    type: url-test
    url: https://www.gstatic.com/generate_204
    interval: 300
    use: [main-subscription]
    filter: "(?i)US|United States|ç¾å›½|ç¾"
  - name: "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
    type: url-test
    url: https://www.gstatic.com/generate_204
    interval: 300
    use: [main-subscription]
    filter: "(?i)SG|Singapore|æ–°åŠ å¡|å¡"
  - name: "ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹"
    type: url-test
    url: https://www.gstatic.com/generate_204
    interval: 300
    use: [main-subscription]
    filter: "(?i)TW|Taiwan|å°æ¹¾|è‡ºæ¹¾|å°"
  - name: "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
    type: url-test
    url: https://www.gstatic.com/generate_204
    interval: 300
    use: [main-subscription]
    filter: "(?i)HK|Hong Kong|é¦™æ¸¯|æ¸¯"
  - name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
    type: url-test
    url: https://www.gstatic.com/generate_204
    interval: 300
    use: [main-subscription]
    filter: "(?i)JP|Japan|æ—¥æœ¬|æ—¥"
  - name: "ğŸŒ å…¶ä»–åœ°åŒº"
    type: url-test
    url: https://www.gstatic.com/generate_204
    interval: 300
    use: [main-subscription]
    filter: "(?i)^(?!.*(US|United States|ç¾å›½|ç¾||SG|Singapore|æ–°åŠ å¡|å¡|TW|Taiwan|å°æ¹¾|è‡ºæ¹¾|å°|HK|Hong Kong|é¦™æ¸¯|æ¸¯|JP|Japan|æ—¥æœ¬|æ—¥)).*$"
  - name: Block
    type: select
    proxies: [REJECT, DIRECT]
  - name: AI
    type: select
    proxies: ["ğŸš€ PROXY", DIRECT]
  - name: "ğŸ“º Streaming"
    type: select
    proxies: ["ğŸš€ PROXY", DIRECT]
  - name: GitHub
    type: select
    proxies: ["ğŸš€ PROXY", DIRECT]
  - name: Apple
    type: select
    proxies: [DIRECT, "ğŸš€ PROXY"]
  - name: Microsoft
    type: select
    proxies: ["ğŸš€ PROXY", DIRECT]
  - name: Games
    type: select
    proxies: ["ğŸš€ PROXY", DIRECT]
  - name: å›½å¤–
    type: select
    proxies: ["ğŸš€ PROXY", DIRECT]
  - name: å›½å†…
    type: select
    proxies: [DIRECT, "ğŸš€ PROXY"]
  - name: å…¶ä»–
    type: select
    proxies: ["ğŸš€ PROXY", DIRECT]

# è§„åˆ™å¼•æ“ & è§„åˆ™é›†
rule-anchor:
  common: &common {type: http, interval: 86400, behavior: classical, format: text}

rules:
  # 1. å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,AdBlock,Block
  # 2. æœ¬åœ° & ç›´è¿
  - RULE-SET,LAN,ç›´è¿
  - RULE-SET,Direct,å›½å†…
  # 3. ç‰¹å®šåº”ç”¨åˆ†æµ
  - RULE-SET,Apple,Apple
  - RULE-SET,Microsoft,Microsoft
  - RULE-SET,Google,å›½å¤–
  - RULE-SETï¼ŒGitHub,GitHub
  - RULE-SETï¼ŒAIï¼ŒAI
  # 4. æ¸¸æˆ
  - RULE-SET,Game,Games
  # 5. æµåª’ä½“ (ç²¾ç»†åŒ–)
  - RULE-SETï¼ŒNetflix,ğŸ“º Streaming
  - RULE-SETï¼ŒDisneyï¼ŒğŸ“º Streaming
  - RULE-SETï¼ŒYouTube,ğŸ“º Streaming
  - RULE-SET,Spotify,ğŸ“º Streaming
  - RULE-SET,Bahamut,ğŸ“º Streaming
  # 6. å…¨çƒæœåŠ¡ (ä½œä¸ºé€šç”¨å›½å¤–æµé‡)
  - RULE-SET,Global,å›½å¤–
  # 7. GEOIP ä½œä¸ºè¡¥å……
  - GEOIP,LAN,ç›´è¿
  - GEOIPï¼ŒCNï¼Œå›½å†…
  # 8. æœ€ç»ˆåŒ¹é…
  - MATCH,å…¶ä»–

rule-providers:
  # ä»¥ä¸‹æ˜¯æ¥è‡ª CommonDist/NewRules ä»“åº“å­ç›®å½•çš„ç²¾ç¡®é“¾æ¥
  # Adblock
  AdBlock: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Adblock/Ad.list"}
  # Domestic-Services
  Direct: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Domestic-Services/Direct.list"}
  # Special
  LAN: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Special/LAN.list"}
  # Apple
  Apple: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Apple/Apple.list"}
  # Global-Services (ç²¾ç»†åŒ–)
  Microsoft: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Global-Services/Microsoft.list"}
  Google: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Global-Services/Google.list"}
  GitHub: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Global-Services/GitHub.list"}
  AI: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Global-Services/AI.list"}
  Netflix: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Global-Services/Netflix.list"}
  Disney: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Global-Services/Disney.list"}
  YouTube: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Global-Services/YouTube.list"}
  Spotify: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Global-Services/Spotify.list"}
  # Game
  Game: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/Game/Game.list"}
  # CCC-Global (ä½œä¸ºé€šç”¨çš„å›½å¤–è§„åˆ™è¡¥å……)
  Global: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/CCC-Global/Global.list"}
  # CCC-CN
  Bahamut: {<<: *common, url: "https://raw.githubusercontent.com/CommonDist/NewRules/main/CCC-CN/Bahamut.list"} # å·´å“ˆå§†ç‰¹ï¼Œè™½ç„¶åœ¨CCC-CNä¸‹ï¼Œä½†é€šå¸¸éœ€è¦ä»£ç†
